<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>ðŸŽ‚ Happy Birthday</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  font-family: 'Segoe UI', sans-serif;
}

body {
  height: 100vh;
  background: radial-gradient(circle at top, #ff9a9e, #fad0c4);
  overflow: hidden;
  color: white;
  text-align: center;
}

.container {
  position: absolute;
  width: 100%;
  top: 50%;
  transform: translateY(-50%);
}

h1 {
  font-size: 2.8rem;
  margin-bottom: 10px;
}

p {
  font-size: 1.2rem;
}

.cake {
  position: relative;
  margin: 30px auto;
  width: 200px;
  height: 140px;
  background: #ffb6c1;
  border-radius: 10px;
}

.candle {
  position: absolute;
  width: 10px;
  height: 40px;
  background: white;
  top: -40px;
  left: 50%;
  transform: translateX(-50%);
}

.flame {
  position: absolute;
  top: -25px;
  left: 50%;
  width: 16px;
  height: 25px;
  background: radial-gradient(circle, #fff700, #ff8c00);
  border-radius: 50%;
  transform: translateX(-50%);
  animation: flicker 0.2s infinite;
}

@keyframes flicker {
  50% { transform: translateX(-50%) scale(0.9); }
}

.heart-container {
  display: none;
  position: fixed;
  inset: 0;
}

.heart {
  position: absolute;
  top: 50%;
  left: 50%;
  font-size: 90px;
  transform: translate(-50%, -50%);
  animation: beat 1s infinite;
}

@keyframes beat {
  50% { transform: translate(-50%, -50%) scale(1.2); }
}

.circle-text {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 300px;
  height: 300px;
  transform: translate(-50%, -50%);
  animation: rotate 12s linear infinite;
}

@keyframes rotate {
  to { transform: translate(-50%, -50%) rotate(360deg); }
}

.circle-text span {
  position: absolute;
  left: 50%;
  top: 0;
  transform-origin: 0 150px;
  font-size: 18px;
}

.sparkle {
  position: absolute;
  font-size: 20px;
  animation: float 4s linear infinite;
}

@keyframes float {
  from { opacity: 0; transform: translateY(50px); }
  to { opacity: 0; transform: translateY(-100px); }
}
</style>
</head>

<body>

<div class="container" id="stage1">
  <h1>ðŸŽ‰ ChÃºc Má»«ng Sinh Nháº­t</h1>
  <p id="info"></p>

  <div class="cake">
    <div class="candle">
      <div class="flame" id="flame"></div>
    </div>
  </div>

  <p>ðŸ‘‰ Nháº¥n nÃºt & thá»•i vÃ o micro ðŸŽ¤</p>
  <button id="startMic">ðŸŽ¤ Báº¯t Ä‘áº§u thá»•i náº¿n</button>
</div>

<div class="heart-container" id="stage2">
  <div class="heart">ðŸ’–</div>
  <div class="circle-text" id="circleText"></div>
</div>

<script>
const name = "Vic Ven";
const birthday = "04/01/2004";
const wish = "ChÃºc má»«ng sinh nháº­t ðŸŽ‚ LuÃ´n háº¡nh phÃºc â€“ máº¡nh khá»e â€“ vÃ  Ä‘Æ°á»£c yÃªu thÆ°Æ¡ng ðŸ’– ";

document.getElementById("info").innerText =ðŸŽ‚ ${name} | ðŸŽˆ ${birthday}`;

let audioContext, analyser, microphone, dataArray;
const flame = document.getElementById("flame");

document.getElementById("startMic").addEventListener("click", async () => {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });

    audioContext = new AudioContext();
    analyser = audioContext.createAnalyser();
    microphone = audioContext.createMediaStreamSource(stream);

    microphone.connect(analyser);
    analyser.fftSize = 256;
    dataArray = new Uint8Array(analyser.frequencyBinCount);

    listen();
  } catch {
    alert("âš ï¸ KhÃ´ng truy cáº­p Ä‘Æ°á»£c micro");
  }
});

function listen() {
  analyser.getByteFrequencyData(dataArray);
  const volume = dataArray.reduce((a,b)=>a+b)/dataArray.length;
  if (volume > 40) blowOut();
  else requestAnimationFrame(listen);
}

function blowOut() {
  flame.style.display = "none";
  stage1.style.display = "none";
  stage2.style.display = "block";
  createCircleText();
  sparkle();
}

function createCircleText() {
  const circle = document.getElementById("circleText");
  [...wish].forEach((c,i)=>{
    const span=document.createElement("span");
    span.innerText=c;
    span.style.transform=`rotate(${i*8}deg)`;
    circle.appendChild(span);
  });
}

function sparkle() {
  setInterval(()=>{
    const s=document.createElement("div");
    s.className="sparkle";
    s.innerText="âœ¨";
    s.style.left=Math.random()*100+"vw";
    s.style.top=Math.random()*100+"vh";
    document.body.appendChild(s);
    setTimeout(()=>s.remove(),4000);
  },300);
}
</script>

</body>
</html>
